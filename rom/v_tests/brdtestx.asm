; üêü –í–µ–∫—Ç–æ—Ä-06—Ü: —Ç–µ—Å—Ç —Å–±—Ä–æ—Å–∞ –±–æ—Ä–¥—é—Ä–∞ –≤ 0 –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
;    –ø–æ—Ä—Ç–∞ 02 –Ω–∞ –≤—ã–≤–æ–¥
;    –û–∂–∏–¥–∞–µ–º–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞:
; 	8 —Å—Ç—Ä–æ–∫ –≤–æ –≤—Å—é —à–∏—Ä—å
;	8 —Å—Ç—Ä–æ–∫ —Ç–æ–ª—å–∫–æ –Ω–∞ —à–∏—Ä–∏–Ω—É —Ä–∞—Å—Ç—Ä–æ–≤–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞, —á–µ—Ä–Ω—ã–π –±–æ—Ä–¥—é—Ä
; 	–ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 8 —Ä–∞–∑ —Ä–∞–∑–Ω—ã–º–∏ –æ—Ç—Ç–µ–Ω–∫–∞–º–∏ –ø–µ—á–∞–ª—å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞

        	.binfile brdtestx.rom
        	.download bin  
        	.tape v06c-rom 	

–ú–ê–ö–û–í–ö–ê		equ $80d9
STRIPE_HEIGHT	equ 16

        	.org 100h

start:
		xra	a
		out	10h
		lxi	sp,100h
		mvi	a,0C3h
		sta	0
		lxi	h, –ï—â—ë
		shld	1

		mvi	a,0C9h
		sta	38h
		ei
		hlt

		lxi	h, colors+15
colorset:
		mvi	a, 88h
		out	0
		mvi	c, 15
colorset1:	mov	a, c
		out	2
		mov	a, m
		out	0Ch
		dcx	h
		out	0Ch
		out	0Ch
		dcr	c
		out	0Ch
		out	0Ch
		out	0Ch
		jp	colorset1
		mvi	a,255
		out	3


–ï—â—ë:
		call	–≤–∞–º_—Ç–µ–º–Ω–æ

		lxi h, –ú–ê–ö–û–í–ö–ê
		mvi e, $8
—Å–ª–µ–¥—É—é—â–∞—è_–ø–æ–ª–æ—Å–∫–∞:
		push h
		push d
		call –ø–æ–ª–æ—Å–∫–∞
–ø–æ–ª–æ—Å–∫–∞
		pop d
		pop h
		mov a, l
		sui STRIPE_HEIGHT
		mov l, a
		dcr e
		jp —Å–ª–µ–¥—É—é—â–∞—è_–ø–æ–ª–æ—Å–∫–∞
—Å–∏–Ω—Ö—Ä–∞
		ei
		hlt
		mvi a, 0
		out 2
		xthl
		xthl
		xthl
		xthl

		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		call —Ç–æ—Ä–º–æ–∑
		
		mvi b, 8
–±–æ—Ä–¥—é—Ä:
		mov a, b
		out 2
		call —Ç–æ—Ä–º–æ–∑
		nop
		nop
		nop
		nop
		nop
		mvi a, $88
		out 0
		call —Ç–æ—Ä–º–æ–∑
		dcr b
		jp –±–æ—Ä–¥—é—Ä
		jmp —Å–∏–Ω—Ö—Ä–∞


		; –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø–æ–ª–æ—Å–∫—É
		; HL = —Å—Ç–æ–ª–±–µ—Ü/—Å—Ç—Ä–æ–∫–∞
		; E = —Ü–≤–µ—Ç
–ø–æ–ª–æ—Å–∫–∞:
		mov a, e
		ral 
		ral
		ral
		ral
		mov e, a

		mvi a, 4
–ø–æ–ª–æ—Å–∫–∞_—Å–ª–æ–π:
		push psw 	; —Å—á–µ—Ç—á–∏–∫ —Å–ª–æ–µ–≤ –ø–æ–ª–µ–∂–∏—Ç –Ω–∞ —Å—Ç–µ–∫–µ


		; –≤–∑—è—Ç—å —Å—Ç–∞—Ä—à–∏–π –±–∏—Ç –∏–∑ E
		mov a, e
		ral
		mov e, a
		; –∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –µ–≥–æ –Ω–∞ –≤–µ—Å—å D
		mvi d, $ff
		jc $+5
		mvi d, 0

		mvi c, 32	; –∑–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ 32 –∫–æ–ª–æ–Ω–∫–∏
–ø–æ–ª–æ—Å–∫–∞_–≤–µ—Ä—Ç–∏–∫–∞–ª—å
		mvi b, STRIPE_HEIGHT
–ø–æ–ª–æ—Å–∫–∏–Ω_—Å—Ç–æ–ª–±–µ—Ü:
		mov m, d
		dcr l
		dcr b
		jp –ø–æ–ª–æ—Å–∫–∏–Ω_—Å—Ç–æ–ª–±–µ—Ü
		
		mov a, l 	; —Å–ª–µ–¥—É—é—â–∏–π —Å—Ç–æ–ª–±–µ—Ü
		adi STRIPE_HEIGHT+1
		mov l, a
		inr h

		dcr c
		jnz –ø–æ–ª–æ—Å–∫–∞_–≤–µ—Ä—Ç–∏–∫–∞–ª—å
		; HL —É–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —Å–ª–æ–π, —É–¥–æ–±–Ω–æ
		pop psw
		dcr a
		jnz –ø–æ–ª–æ—Å–∫–∞_—Å–ª–æ–π

		ret

		; –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = 192 –∫—É–∫–ª–µ—Å–æ–≤, 8 —Å—Ç—Ä–æ–∫ = 1536
		; (–ø—Ä–∏–º–µ—Ä–Ω–æ)
—Ç–æ—Ä–º–æ–∑:		; == 192
		mvi c, 33	; 12

—Ç—É–≥–æ:
		in 0 		; 12
		in 1		; 12
		dcr c 		; 8
		jnz —Ç—É–≥–æ	; 12 		= 176

		ret		; 16

–≤–∞–º_—Ç–µ–º–Ω–æ:
		lxi	h,08000h
		mvi	e,$00
		xra	a
—Ç–µ–º–Ω–æ_—Ü:
		mov	m,e
		inx	h
		cmp	h
		jnz	—Ç–µ–º–Ω–æ_—Ü
		ret

colors:
		.db 00000000b,00001001b,00010010b,00011011b,00100100b,00101101b,00110110b,00111111b
		.db 11111111b,00001001b,00010010b,00011011b,00100100b,00101101b,00110110b,00111111b